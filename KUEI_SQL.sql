DROP TABLE RESREC;
DROP SEQUENCE RESR_SEQ;

CREATE TABLE RESREC (
 RESR_NO             VARCHAR2(15) PRIMARY KEY NOT NULL,
 MEM_NO              VARCHAR2(10) NOT NULL,
 HOUSE_NO            VARCHAR2(10) NOT NULL,
 RTR_NO              VARCHAR2(10) NOT NULL,
 RESR_ODR            TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
 RESR_STATES         VARCHAR2(10 CHAR) NOT NULL,
 RESR_DATE           DATE,
 RESR_PERIOD         VARCHAR2(12),
 HSE_EVAL            CLOB,
 HSE_REV             CLOB,
 MEM_RATE            NUMBER(2),
 MEM_REV             VARCHAR2(50 CHAR),
 RTR_RATE            NUMBER(2)
 );


CREATE SEQUENCE RESR_SEQ;

INSERT INTO RESREC (RESR_NO, MEM_NO, HOUSE_NO, RTR_NO, RESR_STATES, RESR_DATE, RESR_PERIOD)VALUES ('RR'||TO_CHAR(SYSDATE,'RRMMDD')||'-'||(LPAD(to_char(RESR_SEQ.NEXTVAL),5,'0')),'MB00000003','HN00000002','RT00000004','ESTABLISH',TO_DATE('2017/10/28','YYYY/MM/DD'),'10:00-12:00');
INSERT INTO RESREC (RESR_NO, MEM_NO, HOUSE_NO, RTR_NO, RESR_STATES, RESR_DATE, RESR_PERIOD)VALUES ('RR'||TO_CHAR(SYSDATE,'RRMMDD')||'-'||(LPAD(to_char(RESR_SEQ.NEXTVAL),5,'0')),'MB00000002','HN00000001','RT00000003','ESTABLISH',TO_DATE('2017/10/30','YYYY/MM/DD'),'12:00-14:00');
INSERT INTO RESREC (RESR_NO, MEM_NO, HOUSE_NO, RTR_NO, RESR_STATES, RESR_DATE, RESR_PERIOD)VALUES ('RR'||TO_CHAR(SYSDATE,'RRMMDD')||'-'||(LPAD(to_char(RESR_SEQ.NEXTVAL),5,'0')),'MB00000003','HN00000002','RT00000003','ESTABLISH',TO_DATE('2017/10/29','YYYY/MM/DD'),'14:00-16:00');
INSERT INTO RESREC (RESR_NO, MEM_NO, HOUSE_NO, RTR_NO, RESR_STATES, RESR_DATE, RESR_PERIOD)VALUES ('RR'||TO_CHAR(SYSDATE,'RRMMDD')||'-'||(LPAD(to_char(RESR_SEQ.NEXTVAL),5,'0')),'MB00000004','HN00000002','RT00000002','ESTABLISH',TO_DATE('2017/11/01','YYYY/MM/DD'),'18:00-20:00');
UPDATE RESREC set RESR_STATES='CONFIRM',HSE_EVAL='{ "地段":"5", "屋齡":"3", "價格":"2" }',HSE_REV='價格有點小貴，屋齡尚可接受，結論:我覺得可以',MEM_RATE='4',MEM_REV='THIS REALTOR IS GOOD.',RTR_RATE='5' where RESR_NO = 'RR171026-00001';

COMMIT;

CREATE TABLE HSECOLL (
 HOUSE_NO VARCHAR2(10) NOT NULL,
 MEM_NO VARCHAR2(10) NOT NULL,
 CONSTRAINT FK_HOUSENO FOREIGN KEY (HOUSE_NO) REFERENCES HOUSEINFO(HOUSE_NO),
 CONSTRAINT FK_MEMNO FOREIGN KEY (MEM_NO) REFERENCES MEMBER(MEM_NO),
 CONSTRAINT PK_HSECOLL PRIMARY KEY (HOUSE_NO,MEM_NO)
)

INSERT INTO HSECOLL VALUES('HN00000002','MB00000003');
INSERT INTO HSECOLL VALUES('HN00000005','MB00000005');
INSERT INTO HSECOLL VALUES('HN00000008','MB00000002');
INSERT INTO HSECOLL VALUES('HN00000006','MB00000001');
COMMIT;


